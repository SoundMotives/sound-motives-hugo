{{ define "main" }}
<article class="episode">
  <header class="episode-header">
    <h1>{{ .Title }}</h1>

    {{ with .Params.summary }}
    <p class="episode-summary">{{ . }}</p>
    {{ end }} {{ with .Params.audio_url }}
    <section class="episode-audio">
      <audio controls src="{{ . }}"></audio>
    </section>
    {{ end }} {{ with .Resources.GetMatch "featured*" }} {{ $resized := .Fill
    "1600x900" }}
    <figure class="episode-hero">
      <img
        src="{{ $resized.RelPermalink }}"
        alt="{{ $.Title }} featured image"
      />
    </figure>
    {{ end }}
  </header>

  <!-- {{ if .Params.guests }}
  <section class="episode-meta">
    <h3>Guest</h3>
    <ul>
      {{ range .Params.guests }}
      <li><a href="/guests/{{ . }}">{{ . | humanize }}</a></li>
      {{ end }}
    </ul>
  </section>
  {{ end }}  -->
  {{ if .Params.tracklist }}
  <section class="episode-tracklist">
    <h3>Tracklist</h3>
    <ul>
      {{ range .Params.tracklist }}
      <li>{{ . }}</li>
      {{ end }}
    </ul>
  </section>

  {{ end }} {{ if .Params.sound_sources }}
  <section class="episode-meta">
    <h3>Sound Sources</h3>
    <ul class="sound-source-list">
      {{ range .Params.sound_sources }} {{ $source := $.Site.GetPage (printf
      "sound-sources/%s" .) }} {{ if $source }}
      <li>
        <a href="{{ $source.RelPermalink }}">{{ $source.Title }}</a>
      </li>
      {{ end }} {{ end }}
    </ul>
  </section>
  {{ end }}

  <section class="episode-notes">{{ .Content }}</section>

  <!-- More Episodes -->
  <section class="more-episodes">
    <h2>More Episodes</h2>
    <ul class="more-episodes-grid">
      {{ $current := . }} {{ range first 5 (where site.RegularPages "Type"
      "episode") }} {{ if ne .Permalink $current.Permalink }}
      <li class="more-episode-item">
        {{ with .Resources.GetMatch "featured*" }} {{ $thumb := .Resize "400x"
        }}
        <img
          src="{{ $thumb.RelPermalink }}"
          alt="{{ .Title }} thumbnail"
          class="more-episode-thumb"
        />
        {{ end }}
        <div class="more-episode-info">
          <a href="{{ .RelPermalink }}">{{ .Title }}</a>
          {{ with .Params.summary }}
          <p>{{ . }}</p>
          {{ end }}
        </div>
      </li>
      {{ end }} {{ end }}
    </ul>
  </section>
</article>
{{ end }}
